<form>
    {{#if hasAnyActors}}
        <div class="form-group">
            <div class="actor-list-container">
                {{#if hasTargets}}
                    <fieldset class="actor-section">
                        <legend><label> Targeted Actors </label></legend>
                        <div class="actor-grid">
                            {{#each targets}}
                                <div class="actor-card {{#if selected}}selected{{/if}}" data-actor-id="{{id}}">
                                    <input type="radio" name="selectedActor" value="{{id}}" {{#if selected}}checked{{/if}} hidden>
                                    <div class="actor-portrait">
                                        <img src="{{img}}" alt="{{name}}" loading="lazy">
                                    </div>
                                    <div class="actor-info">
                                        <span class="actor-name">{{name}}</span>
                                        <span class="actor-type">Targeted</span>
                                    </div>
                                    <i class="fas fa-check-circle selection-indicator"></i>
                                </div>
                            {{/each}}
                        </div>
                    </fieldset>
                {{/if}}
                
                {{#if (and (or allowPlayerTargeting isGM) hasPlayerCharacters)}}
                    <fieldset class="actor-section">
                        <legend><label> {{#if isGM}}Player{{else}}Your{{/if}} Characters </label></legend>
                        <div class="actor-grid">
                            {{#each playerCharacters}}
                                <div class="actor-card {{#if selected}}selected{{/if}}" data-actor-id="{{id}}">
                                    <input type="radio" name="selectedActor" value="{{id}}" {{#if selected}}checked{{/if}} hidden>
                                    <div class="actor-portrait">
                                        <img src="{{img}}" alt="{{name}}" loading="lazy">
                                    </div>
                                    <div class="actor-info">
                                        <span class="actor-name">{{name}}</span>
                                        <span class="actor-type">Character</span>
                                    </div>
                                    <i class="fas fa-check-circle selection-indicator"></i>
                                </div>
                            {{/each}}
                        </div>
                    </fieldset>
                {{/if}}

                {{#if (and (or allowPlayerTargeting isGM) hasNonPlayerCharacters)}}
                    <fieldset class="actor-section">
                        <legend><label> {{#if isGM}}Player{{else}}Your{{/if}} NPCs </label></legend>
                        <div class="actor-grid">
                            {{#each nonPlayerCharacters}}
                                <div class="actor-card {{#if selected}}selected{{/if}}" data-actor-id="{{id}}">
                                    <input type="radio" name="selectedActor" value="{{id}}" {{#if selected}}checked{{/if}} hidden>
                                    <div class="actor-portrait">
                                        <img src="{{img}}" alt="{{name}}" loading="lazy">
                                    </div>
                                    <div class="actor-info">
                                        <span class="actor-name">{{name}}</span>
                                        <span class="actor-type">NPC</span>
                                    </div>
                                    <i class="fas fa-check-circle selection-indicator"></i>
                                </div>
                            {{/each}}
                        </div>
                    </fieldset>
                {{/if}}

                {{#if (and isGM hasAllTokens)}}
                    <fieldset class="actor-section">
                        <legend><label> Scene Tokens </label></legend>
                        <div class="actor-grid">
                            {{#each allTokens}}
                                <div class="actor-card {{#if selected}}selected{{/if}}" data-actor-id="{{id}}">
                                    <input type="radio" name="selectedActor" value="{{id}}" {{#if selected}}checked{{/if}} hidden>
                                    <div class="actor-portrait">
                                        <img src="{{img}}" alt="{{name}}" loading="lazy">
                                    </div>
                                    <div class="actor-info">
                                        <span class="actor-name">{{name}}</span>
                                        <span class="actor-type">{{#if (eq type "NPC")}}NPC{{else}}Token{{/if}}</span>
                                    </div>
                                    <i class="fas fa-check-circle selection-indicator"></i>
                                </div>
                            {{/each}}
                        </div>
                    </fieldset>
                {{/if}}
            </div>
        </div>
    {{else}}
        <div class="form-group">
            <div class="notification warning">
                <i class="fas fa-exclamation-triangle"></i>
                {{#if isGM}}
                <p>No valid targets available. Please target actors on the canvas or add characters to the scene.</p>
                {{else}}
                <p>No valid targets available. Please target actors on the canvas or enable player targeting.</p>
                {{/if}}
            </div>
        </div>
    {{/if}}

    <footer class="form-footer flexrow">
        <button type="submit" class="bright" data-action="select">
            <i class="fas fa-check"></i> Select
        </button>
        <button type="button" data-action="cancel">
            <i class="fas fa-times"></i> Cancel
        </button>
    </footer>
</form>
